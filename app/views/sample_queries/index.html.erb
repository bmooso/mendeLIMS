<h3>Listing <%= @type_of_sample.camelize %> Samples - <%=h @heading_string %></h3>

<% form_tag :action => :export_samples do %>

<%=h @nr_samples[0] %> source samples, (for <%=h @samples_by_patient.size -%> patients) <%= submit_tag "Export Samples" -%>
<br/><br/>

<table class="list">
  <tr>
  	<th>Barcode</th>
    <th>Source</th>
    <th>Sample Date</th>
    <th>OR Designation</th>
    <th>Container Type</th>
    <th>Amount</th>
    <th>Rem?</th>
    <th>Room/Freezer</th>
    <th>Shelf</th>
    <th>Rack#/Bin</th>
	<th>Extracted?</th> 
	<th colspan=2></th>
  </tr>
  
  <% if @samples_by_patient %>
    <% @samples_by_patient.sort.each do | patient_id, samples| %>
    <tr>
    <td colspan=13><b>Patient: </b><%=link_to patient_id[0], patient_path(:id => patient_id[0]) %>
    <% if can? :read, Patient %>
      / <%=h patient_id[1]%>
    <% end %>
    </td>
    </tr>

    <% samples.each do |sample| %>
      <tr>
      	<td><%= link_to sample.barcode_key, edit_sample_path(sample)%></td>
        <% if sample.clinical_sample == 'yes' %>
		<td> Clinical </td>
        <% else %>
		<td>Sample: <%=h sample.source_barcode_key %></td>
        <% end %>
        <td><%=h sample.sample_date %></td>
        <td><%=h sample.tumor_normal %></td>
        <td><%=h sample.container_type %></td>
        <td><%=h sample.sample_amt %></td>
        <td><%=h sample.sample_remaining%></td>
        <td><% if sample.storage_location %><%=h sample.storage_location.location_string %><% end %></td>
        <td><%=h sample.storage_shelf %></td>
        <td><%=h sample.storage_boxbin %></td>
		<%= render :partial => 'sample_links', :locals => {:sample => sample,
                                               :sample_characteristic => sample.sample_characteristic} %>
	    <td><%= hidden_field_tag("export_id[]", sample.id)  %></td>
      </tr>
	  <% if !sample.comments.blank? %>
	  <tr>
	  	<td colspan=2></td>
		<td>Comments: </td>
        <td colspan=7><%=h sample.comments %></td>
	  </tr>
	  <% end %>
    <% end %>
	
  <% end %>
<% end %>
</table>
<%end %>

<% if params[:add_new] == 'yes'%>
  <p>Click <%= link_to 'here', new_dissected_sample_path(:source_sample_id => params[:source_sample_id]) %> 
     to add additional dissected sample from same source sample </p>
<% end %>
