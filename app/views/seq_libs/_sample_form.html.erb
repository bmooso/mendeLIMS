<div id='libs_form'>
<%= submit_tag "Save libraries" %>&nbsp;&nbsp;&nbsp;
<%= submit_to_remote 'Singleplex', 'Refesh from Defaults',
      :url => {:action => 'populate_libs', :nr_libs => @new_lib.size},
      :update => 'libs_form' %>
<div>&nbsp;</div>
 <%= hidden_field_tag(:nr_libs, @new_lib.size) %>
 <% @new_lib.each_with_index do |lib, i| %>
    <% fields_for 'seq_lib_' + i.to_s, lib do |f| %> 
      <% fields_for 'lib_sample_' + i.to_s, @lib_samples[i] do |s| %>
        <%= s.error_messages %>
        <%= f.hidden_field(:owner) %>
	    <%= f.hidden_field(:preparation_date) %>
	    <%= f.hidden_field(:protocol_id) %>
		<%= f.hidden_field(:project) %>
<table class="list">
<tr>
	<th>Barcode</th>
	<th>Lib Name</th>
    <th>Sample Conc</th>
	<th>Adapter</th>
	<th>Tag#</th>
	<th>Quantitation</th>
	<th>Size(Final PCR)</th>
    <th>Library Conc</th>
	<th>Align Ref</th>
	<th>Trim Bases</th> 
	<th>Enzyme</th>
</tr>
<tr>
    <td class="dotted_border_bottom"><%= f.text_field :barcode_key, :size => 10 %></td>
    <td class="dotted_border_bottom"><%= f.text_field(:lib_name, :size => 15)%></td>
	<td class="dotted_border_bottom"><%= f.text_field(:sample_conc, :size => 6)%> ng/ul</td>
    <td class="dotted_border_bottom"><%= f.collection_select(:runtype_adapter, @adapters, :c_value, :c_value) %></td>
	<td class="dotted_border_bottom"><%= s.text_field(:index_tag, :size => 4) %></td>       
    <td class="dotted_border_bottom"><%= f.collection_select(:quantitation_method, @quantitation, :c_value, :c_value,
                                                            {:include_blank => 'Select Method'}) %></td>
	<td class="dotted_border_bottom"><%= f.text_field(:pcr_size, :size => 6) %></td> 
	<td class="dotted_border_bottom"><%= f.text_field(:lib_conc_requested, :size => 6)%>pM</td>
    <td class="dotted_border_bottom"><%= f.collection_select(:alignment_ref_id, @align_refs, :id, :alignment_key) %></td>
	<td class="dotted_border_bottom"><%= f.text_field(:trim_bases, :size => 6) %></td>
	<td class="dotted_border_bottom"><%= s.text_field(:enzyme_code, :size => 10) %></td>
</tr>
<tr>
  <td style="text-align:right"><strong><em>Source DNA/RNA:</em></strong></td>
  <td><%= s.text_field_with_auto_complete :source_sample_name, {:size => 12},
              {:url => {:controller => :processed_samples, :action => :auto_complete_for_barcode_key},
               :param_name => :search, :min_chars => 2, :method => :get} %></td>
  <td style="text-align:right"><strong><em>Notebook Ref:</em></strong></th>
  <td colspan="2"><%= f.text_field(:notebook_ref, :size => 30)%></td>  
  <td style="text-align:right"><strong><em>Notes:</em></strong></td>
  <td colspan="6"><%= f.text_field(:notes, :size => 80)%></td> 
</tr>
</table>
    <% end %>
  <% end %>
<% end %>
</div>
<br/>