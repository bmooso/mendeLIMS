<div id='assays_form'>
<%= submit_tag "Save assays" %>&nbsp;&nbsp;&nbsp;
<%= submit_to_remote 'AssayRefresh', 'Refesh from Defaults',
      :url => {:action => 'populate_assays', :nr_assays => @new_assay.size},
      :update => 'assays_form' %>
<%= break_clear %>
	  
<fieldset class="form">
<legend>Assays</legend>
  <%= hidden_field_tag(:nr_assays, @new_assay.size) %>
  <table class="form-with-columns">
  <tr>
    <th></th>
	<th>Barcode</th>
	<th>Source DNA/RNA</th>
	<th>Volume</th>
	<th>Conc(ng/ul)</th>
	<th>Notes</th>
  </tr>
  
  <% @new_assay.each_with_index do |assay, i| %>
    <% fields_for 'molecular_assay_' + i.to_s, assay do |f| %> 
      <% fields_for 'lib_sample_' + i.to_s, @lib_samples[i] do |s| %>
        <tr><td colspan="5"><%= s.error_messages %></td></tr>
        <%= f.hidden_field(:owner) %>
	    <%= f.hidden_field(:preparation_date) %>
	    <%= f.hidden_field(:protocol_id) %>
  <tr>
    <td><em>Sample: <%= i+1 %></em></td>
    <td>Generated</td>
    <td><%= s.text_field_with_auto_complete :source_DNA, {:size => 12},
              {:url => {:controller => :processed_samples, :action => :auto_complete_for_barcode_key},
               :param_name => :search, :min_chars => 2, :method => :get, 
			   
			   :after_update_element => "function(element,value){" + 
			     remote_function(:url => { :action => :update_fields, :i => i},
                                 :with => "'source_DNA=' + element.value") + "}"} %></td>
	<td><input id=<%= "lib_sample_" + i.to_s + "_final_vol"%> size="8">&nbsp;</input></td>
	<td><input id=<%= "lib_sample_" + i.to_s + "_final_conc"%> size="8">&nbsp;</input></td>
	<td><%= f.text_field(:notes, :size => 30)%></td> 
  </tr>
  <tr><td colspan="7"></td></tr>
  <!--%= row_underline(cols=12)%-->
    <% end %>
  <% end %>
<% end %>
</table>
</fieldset>
</div>